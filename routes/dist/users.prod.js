"use strict";var auth=require("../middleware/auth"),bcrypt=require("bcrypt"),_=require("lodash"),_require=require("../models/user"),User=_require.User,validate=_require.validate,express=require("express"),router=express.Router();router.get("/me",auth,function(r,t){var a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(User.findById(r.user._id).select("-password"));case 2:a=e.sent,t.send(a);case 4:case"end":return e.stop()}})}),router.post("/",function(r,t){var a,s,n,u,i;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=validate(r.body),s=a.error)return e.abrupt("return",t.status(400).send(s.details[0].message));e.next=3;break;case 3:return e.next=5,regeneratorRuntime.awrap(User.findOne({email:r.body.email}));case 5:if(n=e.sent)return e.abrupt("return",t.status(400).send("User already registered."));e.next=8;break;case 8:return n=new User(_.pick(r.body,["name","email","password"])),e.next=11,regeneratorRuntime.awrap(bcrypt.genSalt(10));case 11:return u=e.sent,e.next=14,regeneratorRuntime.awrap(bcrypt.hash(n.password,u));case 14:return n.password=e.sent,e.next=17,regeneratorRuntime.awrap(n.save());case 17:i=n.generateAuthToken(),t.header("x-auth-token",i).header("access-control-expose-headers","x-auth-token").send(_.pick(n,["_id","name","email"]));case 19:case"end":return e.stop()}})}),module.exports=router;